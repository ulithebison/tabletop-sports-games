<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabletop Sports Games Archive</title>
    
    <!-- Supabase Client Library - KORRIGIERTER LINK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- GoatCounter Analytics -->
    <script data-goatcounter="https://tabletop-sports-games.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #f1f1f1;
            font-size: 1.5rem;
        }
        .error {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ff6b6b;
            font-size: 1.2rem;
            padding: 2rem;
            text-align: center;
        }
        .error-details {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            borderRadius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
            max-width: 600px;
            font-size: 0.9rem;
            font-family: monospace;
            text-align: left;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Supabase Config laden -->
    <script src="supabase-config.js"></script>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // Lucide Icons
        const Search = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const Filter = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
            </svg>
        );

        const Mail = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
        );

        const Home = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        );

        // Main App
        function SportsGamesDatabase() {
            const [games, setGames] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [selectedGame, setSelectedGame] = useState(null);
            const [searchTerm, setSearchTerm] = useState("");
            const [selectedSport, setSelectedSport] = useState("All");
            const [selectedType, setSelectedType] = useState("All");
            const [selectedComplexity, setSelectedComplexity] = useState("All");
            const [showFilters, setShowFilters] = useState(false);

            useEffect(() => {
                loadGames();
            }, []);

            async function loadGames() {
                try {
                    setLoading(true);
                    setError(null);

                    // Check if supabase client exists
                    if (typeof window.supabaseClient === 'undefined') {
                        throw new Error('Supabase not connected. Check your supabase-config.js file and API keys.');
                    }

                    console.log('Loading games from Supabase...');
                    
                    const { data, error: fetchError } = await window.supabaseClient
                        .from('games')
                        .select('*')
                        .order('name');

                    if (fetchError) {
                        console.error('Supabase error:', fetchError);
                        throw fetchError;
                    }

                    console.log('‚úÖ Loaded', data?.length || 0, 'games');
                    setGames(data || []);
                    
                } catch (err) {
                    console.error('‚ùå Error loading games:', err);
                    setError(err.message || 'Unknown error');
                } finally {
                    setLoading(false);
                }
            }

            // Get unique values for filters
            const sports = useMemo(() => {
                const unique = [...new Set(games.map(g => g.sport))].filter(Boolean);
                return ["All", ...unique.sort()];
            }, [games]);

            const types = useMemo(() => {
                const unique = [...new Set(games.map(g => g.type))].filter(Boolean);
                return ["All", ...unique.sort()];
            }, [games]);

            const complexityLevels = useMemo(() => {
                const unique = [...new Set(games.map(g => g.complexity))].filter(Boolean);
                return ["All", ...unique.sort()];
            }, [games]);

            // Filter games
            const filteredGames = useMemo(() => {
                return games.filter(game => {
                    const matchesSearch = game.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                        game.description?.toLowerCase().includes(searchTerm.toLowerCase());
                    const matchesSport = selectedSport === "All" || game.sport === selectedSport;
                    const matchesType = selectedType === "All" || game.type === selectedType;
                    const matchesComplexity = selectedComplexity === "All" || game.complexity === selectedComplexity;
                    
                    return matchesSearch && matchesSport && matchesType && matchesComplexity;
                });
            }, [games, searchTerm, selectedSport, selectedType, selectedComplexity]);

            const activeFiltersCount = [selectedSport, selectedType, selectedComplexity].filter(f => f !== "All").length;

            // Loading
            if (loading) {
                return (
                    <div className="loading">
                        <div>
                            <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>üé≤</div>
                            <div>Loading games from database...</div>
                        </div>
                    </div>
                );
            }

            // Error
            if (error) {
                return (
                    <div className="error">
                        <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>‚ö†Ô∏è</div>
                        <div>Error loading games</div>
                        <div className="error-details">
                            <strong>Error:</strong> {error}
                            <br/><br/>
                            <strong>Troubleshooting:</strong>
                            <br/>1. Check if supabase-config.js exists
                            <br/>2. Check if API keys are correct
                            <br/>3. Check browser console (F12)
                        </div>
                        <button 
                            onClick={loadGames}
                            style={{
                                marginTop: '2rem',
                                padding: '1rem 2rem',
                                background: '#ff6b6b',
                                border: 'none',
                                borderRadius: '12px',
                                color: '#fff',
                                fontSize: '1rem',
                                fontWeight: '600',
                                cursor: 'pointer'
                            }}
                        >
                            Retry
                        </button>
                    </div>
                );
            }

            // Main view
            return (
                <div style={{
                    minHeight: '100vh',
                    background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)',
                    color: '#f1f1f1'
                }}>
                    {/* Header */}
                    <header style={{
                        background: 'rgba(255, 255, 255, 0.05)',
                        backdropFilter: 'blur(10px)',
                        borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
                        padding: '2rem 1rem',
                        position: 'sticky',
                        top: 0,
                        zIndex: 100
                    }}>
                        <div style={{ maxWidth: '1400px', margin: '0 auto' }}>
                            <div style={{
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                flexWrap: 'wrap',
                                gap: '1rem',
                                marginBottom: '1rem'
                            }}>
                                <h1 style={{
                                    fontSize: 'clamp(2rem, 5vw, 3.5rem)',
                                    fontWeight: '900',
                                    margin: '0',
                                    background: 'linear-gradient(135deg, #ff6b6b 0%, #ffd93d 50%, #6bcf7f 100%)',
                                    WebkitBackgroundClip: 'text',
                                    WebkitTextFillColor: 'transparent',
                                    letterSpacing: '-0.02em'
                                }}>
                                    Tabletop Sports Games Archive
                                </h1>
                                
                                <nav style={{ display: 'flex', gap: '1rem' }}>
                                    <a href="index.html" style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.5rem',
                                        padding: '0.75rem 1.25rem',
                                        background: 'rgba(255, 255, 255, 0.1)',
                                        border: '1px solid rgba(255, 255, 255, 0.2)',
                                        borderRadius: '12px',
                                        color: '#f1f1f1',
                                        textDecoration: 'none',
                                        fontWeight: '600'
                                    }}>
                                        <Home size={20} /> Home
                                    </a>
                                    <a href="contact.html" style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.5rem',
                                        padding: '0.75rem 1.25rem',
                                        background: 'rgba(255, 255, 255, 0.05)',
                                        border: '1px solid rgba(255, 255, 255, 0.1)',
                                        borderRadius: '12px',
                                        color: '#f1f1f1',
                                        textDecoration: 'none',
                                        fontWeight: '600'
                                    }}>
                                        <Mail size={20} /> Contact
                                    </a>
                                </nav>
                            </div>
                            
                            <p style={{
                                fontSize: '1.1rem',
                                color: 'rgba(255, 255, 255, 0.7)',
                                margin: 0
                            }}>
                                Your database for tabletop, dice & card sports games
                            </p>
                        </div>
                    </header>

                    <div style={{ maxWidth: '1400px', margin: '2rem auto', padding: '0 1rem' }}>
                        {/* Search & Filters */}
                        <div style={{ display: 'flex', gap: '1rem', marginBottom: '1.5rem', flexWrap: 'wrap' }}>
                            <div style={{ flex: '1', minWidth: '250px', position: 'relative' }}>
                                <Search style={{
                                    position: 'absolute',
                                    left: '1rem',
                                    top: '50%',
                                    transform: 'translateY(-50%)',
                                    color: 'rgba(255, 255, 255, 0.4)'
                                }} />
                                <input
                                    type="text"
                                    placeholder="Search games..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    style={{
                                        width: '100%',
                                        padding: '1rem 1rem 1rem 3rem',
                                        background: 'rgba(255, 255, 255, 0.05)',
                                        border: '1px solid rgba(255, 255, 255, 0.1)',
                                        borderRadius: '12px',
                                        color: '#f1f1f1',
                                        fontSize: '1rem',
                                        outline: 'none'
                                    }}
                                />
                            </div>

                            <button onClick={() => setShowFilters(!showFilters)} style={{
                                padding: '1rem 1.5rem',
                                background: activeFiltersCount > 0 ? 'rgba(255, 107, 107, 0.2)' : 'rgba(255, 255, 255, 0.05)',
                                border: `1px solid ${activeFiltersCount > 0 ? 'rgba(255, 107, 107, 0.5)' : 'rgba(255, 255, 255, 0.1)'}`,
                                borderRadius: '12px',
                                color: '#f1f1f1',
                                cursor: 'pointer',
                                display: 'flex',
                                alignItems: 'center',
                                gap: '0.5rem',
                                fontWeight: '600'
                            }}>
                                <Filter size={20} />
                                Filter {activeFiltersCount > 0 && `(${activeFiltersCount})`}
                            </button>
                        </div>

                        {showFilters && (
                            <div style={{
                                background: 'rgba(255, 255, 255, 0.05)',
                                border: '1px solid rgba(255, 255, 255, 0.1)',
                                borderRadius: '12px',
                                padding: '1.5rem',
                                marginBottom: '2rem',
                                display: 'grid',
                                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                                gap: '1.5rem'
                            }}>
                                <FilterGroup label="Sport" options={sports} selected={selectedSport} onChange={setSelectedSport} />
                                <FilterGroup label="Type" options={types} selected={selectedType} onChange={setSelectedType} />
                                <FilterGroup label="Complexity" options={complexityLevels} selected={selectedComplexity} onChange={setSelectedComplexity} />
                            </div>
                        )}

                        <p style={{ color: 'rgba(255, 255, 255, 0.6)', marginBottom: '1.5rem' }}>
                            {filteredGames.length} game{filteredGames.length !== 1 ? 's' : ''} found
                        </p>

                        {/* Games Grid */}
                        <div style={{
                            display: 'grid',
                            gridTemplateColumns: 'repeat(auto-fill, minmax(320px, 1fr))',
                            gap: '2rem'
                        }}>
                            {filteredGames.map(game => (
                                <GameCard key={game.id} game={game} />
                            ))}
                        </div>

                        {filteredGames.length === 0 && (
                            <div style={{
                                textAlign: 'center',
                                padding: '4rem 1rem',
                                color: 'rgba(255, 255, 255, 0.5)'
                            }}>
                                <p style={{ fontSize: '1.2rem' }}>No games found</p>
                                <p>Try different search terms or filters</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function FilterGroup({ label, options, selected, onChange }) {
            return (
                <div>
                    <label style={{
                        display: 'block',
                        fontSize: '0.85rem',
                        fontWeight: '600',
                        color: 'rgba(255, 255, 255, 0.7)',
                        marginBottom: '0.5rem',
                        textTransform: 'uppercase'
                    }}>
                        {label}
                    </label>
                    <select value={selected} onChange={(e) => onChange(e.target.value)} style={{
                        width: '100%',
                        padding: '0.75rem',
                        background: 'rgba(255, 255, 255, 0.05)',
                        border: '1px solid rgba(255, 255, 255, 0.1)',
                        borderRadius: '8px',
                        color: '#f1f1f1',
                        cursor: 'pointer',
                        outline: 'none'
                    }}>
                        {options.map(opt => (
                            <option key={opt} value={opt} style={{ background: '#16213e' }}>{opt}</option>
                        ))}
                    </select>
                </div>
            );
        }

        function GameCard({ game }) {
            const [isHovered, setIsHovered] = useState(false);
            const imageUrl = game.images?.[0] || 'https://via.placeholder.com/800x600/333333/ffffff?text=No+Image';

            return (
                <div
                    onMouseEnter={() => setIsHovered(true)}
                    onMouseLeave={() => setIsHovered(false)}
                    style={{
                        background: 'rgba(255, 255, 255, 0.05)',
                        border: '1px solid rgba(255, 255, 255, 0.1)',
                        borderRadius: '16px',
                        overflow: 'hidden',
                        cursor: 'pointer',
                        transition: 'all 0.3s',
                        transform: isHovered ? 'translateY(-8px)' : 'translateY(0)'
                    }}
                >
                    <div style={{
                        height: '200px',
                        background: `url(${imageUrl}) center/cover`,
                        position: 'relative'
                    }}>
                        <div style={{
                            position: 'absolute',
                            inset: 0,
                            background: 'linear-gradient(to top, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0) 100%)'
                        }} />
                        
                        <div style={{
                            position: 'absolute',
                            top: '1rem',
                            right: '1rem',
                            background: 'rgba(255, 255, 255, 0.95)',
                            color: '#1a1a2e',
                            padding: '0.4rem 0.8rem',
                            borderRadius: '20px',
                            fontSize: '0.75rem',
                            fontWeight: '700',
                            textTransform: 'uppercase'
                        }}>
                            {game.type}
                        </div>
                    </div>

                    <div style={{ padding: '1.5rem' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.5rem' }}>
                            <span style={{ fontSize: '0.85rem', color: '#ffd93d', fontWeight: '600' }}>
                                {game.sport}
                            </span>
                            <span style={{ color: 'rgba(255, 255, 255, 0.3)' }}>‚Ä¢</span>
                            <span style={{ fontSize: '0.85rem', color: 'rgba(255, 255, 255, 0.5)' }}>
                                {game.year}
                            </span>
                        </div>

                        <h3 style={{
                            fontSize: '1.4rem',
                            fontWeight: '700',
                            margin: '0 0 0.75rem 0',
                            lineHeight: '1.3'
                        }}>
                            {game.name}
                        </h3>

                        {game.subtitle && (
                            <p style={{
                                fontSize: '0.9rem',
                                color: 'rgba(255, 255, 255, 0.6)',
                                margin: '0 0 0.75rem 0',
                                fontStyle: 'italic'
                            }}>
                                {game.subtitle}
                            </p>
                        )}

                        <p style={{
                            fontSize: '0.95rem',
                            color: 'rgba(255, 255, 255, 0.7)',
                            lineHeight: '1.5',
                            display: '-webkit-box',
                            WebkitLineClamp: 3,
                            WebkitBoxOrient: 'vertical',
                            overflow: 'hidden'
                        }}>
                            {game.description}
                        </p>

                        <div style={{
                            display: 'flex',
                            justifyContent: 'space-between',
                            paddingTop: '1rem',
                            marginTop: '1rem',
                            borderTop: '1px solid rgba(255, 255, 255, 0.1)',
                            fontSize: '0.85rem',
                            color: 'rgba(255, 255, 255, 0.6)'
                        }}>
                            <span>üë• {game.players}</span>
                            <span>üìä {game.complexity}</span>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<SportsGamesDatabase />, document.getElementById('root'));
    </script>
</body>
</html>
